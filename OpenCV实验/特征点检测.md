2020-10-8

## OpenCV-Python Feature2D 特征点检测（含SIFT/SURF/ORB/KAZE/FAST/BRISK/AKAZE)

https://blog.csdn.net/amusi1994/article/details/79591205

对于OpenCV-Python，OpenCV2.x和OpenCV3.x的函数使用方式有很大不同。网上很多教程都还是基于OpenCV2.x，此版本已经逐渐被弃用。

本教程针对特征点检测，分析OpenCV2.x和OpenCV3.x的不同之后，并重点介绍OpenCV3.x-Python的特征点检测。

## OpenCV3.x-python 特征点检测方法

对于OpenCV3.x-Python，特征点检测及显示方法如下：

```python
# OpenCV3.x-Python
# 注意有_create() 后缀
function = cv2.Function_Name_create() #Function_Name 是特征检测方法的函数名，如BRISK、FastFeatureDetector等。
keypoints = function.detect(img,None)
# 注意显示特征点之前要先将img2 初始化
img2 = img.copy()
img2 = cv2.drawKeyPoints(img,keypoints,color=(0,255,0))
```

* 注意1：对于OpenCV3.x-python，还要在Function_Name 后加上_create 后缀。其实这一点在[opencv_doc](https://docs.opencv.org/master/d0/d13/classcv_1_1Feature2D.html#a5968e9bc8497a8eb845272b9442559f3)中具体的函数python使用方法中已经注明了。
* 注意2：对于OpenCV3.x-Python，若要显示检测的特征点，需要初始化img2，才能正常显示。这里可以先使用img2 = img.copy()完成拷贝初始化。

下面就重点介绍OpenCV3.x-Python中的各种特征点检测方法的使用示例。

测试图像为标准的lena.png

## AKAZE Feature Detection

```python
#!/usr/bin/env python
# -*- coding=utf-8 -*-
# Summary: 使用OpenCV3.x-Python检测AKAZE特征点
# Author:  Amusi
# Date:    2018-03-17
# Reference: https://docs.opencv.org/master/d8/d30/classcv_1_1AKAZE.html
 
import cv2
import numpy
 
def main():
 
	img = cv2.imread("lena.png")
	cv2.imshow('Input Image', img)
	cv2.waitKey(0)
	
	# 检测
	akaze = cv2.AKAZE_create()
	keypoints = akaze.detect(img, None)
	
	# 显示特征点
	# 必须要先初始化img2
	img2 = img.copy()
	img2 = cv2.drawKeypoints(img, keypoints, img2, color=(0,255,0))
	cv2.imshow('Detected AKAZE keypoints', img2)
	cv2.waitKey(0)
    
if __name__ == '__main__':
	main()
```

**`if __name__ == '__main__':` 的作用：**

python代码可以作为两种方式来运行：

1. 当作脚本直接执行
2. 可以import到其他脚本中去执行

在一些情况下，我们想把脚本1import到脚本2中去，但是又不想再运行脚本2的时候把脚本1里面的代码给执行了，那么这时候就要用到`if __name__=='__main__'`了。

首先 每个py文件里面都会有一个`__name__`内置变量，当我们直接执行脚本的时候`__name__`的值此时为`__main__`。

当脚本1 被import到其他脚本中时 此时`__name__`的值就变成了脚本1 的文件名，所以执行脚本1 的代码时，`__name__ == '__main__'` 判断结果为false，里面的代码就不会执行。

## BRISK Feature Detection

```python
#!/usr/bin/env python
# -*- coding=utf-8 -*-
# Summary: 使用OpenCV3.x-Python检测BRISK特征点
# Author:  Amusi
# Date:    2018-03-17
# Reference: https://docs.opencv.org/master/de/dbf/classcv_1_1BRISK.html
 
import cv2
import numpy
 
def main():
	img = cv2.imread("lena.png")
	cv2.imshow('Input Image', img)
	cv2.waitKey(0)
 
 
	brisk = cv2.BRISK_create()
	keypoints = brisk.detect(img, None)
	
	# 必须要先初始化img2
	img2 = img.copy()
	img2 = cv2.drawKeypoints(img, keypoints, img2, color=(0,255,0))
	cv2.imshow('Detected BRISK keypoints', img2)
	cv2.waitKey(0)
    
if __name__ == '__main__':
	main()
```



## Fast Feature Detection

```python
#!/usr/bin/env python
# -*- coding=utf-8 -*-
# Summary: 使用OpenCV3.x-Python检测FAST特征点
# Author:  Amusi
# Date:    2018-03-17
# Reference: https://docs.opencv.org/master/df/d74/classcv_1_1FastFeatureDetector.html
 
import cv2
import numpy
 
def main():
 
	img = cv2.imread("lena.png")
	cv2.imshow('Input Image', img)
	cv2.waitKey(0)
 
	# 2018-03-17 Amusi: OpenCV3.x FeatureDetector写法有变化
	# OpenCV2.x
	# fast = cv2.FastFeatureDetector()
	# keypoints = fast.detect(img, None)
	
	# OpenCV3.x
	# 注意有_create()后缀
	fast = cv2.FastFeatureDetector_create()
	keypoints = fast.detect(img, None)
	
	# 必须要先初始化img2
	img2 = img.copy()
	img2 = cv2.drawKeypoints(img, keypoints, img2, color=(0,255,0))
	cv2.imshow('Detected FAST keypoints', img2)
	cv2.waitKey(0)
    
if __name__ == '__main__':
	main()
```

## KAZE Feature Detection

```python
#!/usr/bin/env python
# -*- coding=utf-8 -*-
# Summary: 使用OpenCV3.x-Python检测KAZE特征点
# Author:  Amusi
# Date:    2018-03-17
# Reference: https://docs.opencv.org/master/d3/d61/classcv_1_1KAZE.html
 
import cv2
import numpy
 
def main():
 
	img = cv2.imread("lena.png")
	cv2.imshow('Input Image', img)
	cv2.waitKey(0)
	
	# 检测
	kaze = cv2.KAZE_create()
	keypoints = kaze.detect(img, None)
	
	# 显示
	# 必须要先初始化img2
	img2 = img.copy()
	img2 = cv2.drawKeypoints(img, keypoints, img2, color=(0,255,0))
	cv2.imshow('Detected KAZE keypoints', img2)
	cv2.waitKey(0)
    
if __name__ == '__main__':
	main()
```

## ORB Feature Detection

```python
#!/usr/bin/env python
# -*- coding=utf-8 -*-
# Summary: 使用OpenCV3.x-Python检测ORB特征点
# Author:  Amusi
# Date:    2018-03-17
# Reference: https://docs.opencv.org/master/db/d95/classcv_1_1ORB.html
 
 
import cv2
import numpy
 
 
def main():
 
 
	img = cv2.imread("lena.png")
	cv2.imshow('Input Image', img)
	cv2.waitKey(0)
	
	# 检测
	orb = cv2.ORB_create()
	keypoints = orb.detect(img, None)
	
	# 显示
	# 必须要先初始化img2
	img2 = img.copy()
	img2 = cv2.drawKeypoints(img, keypoints, img2, color=(0,255,0))
	cv2.imshow('Detected ORB keypoints', img2)
	cv2.waitKey(0)
    
if __name__ == '__main__':
	main()
```

-------

下面介绍属于nonfree的特征检测方法，如SIFT和SURF。

这些方法在opencv-contrib中，所以想要使用前，请卸载当前非contrib版本的opencv，即pip uninstall opencv-python后；再重新安装opencv-contrib-python，即pip install opencv-contrib-python

2020-10-8 : 我之接在jupyter 下运行代码出错，里面是contrib版本的吧，不过，github上有其他的实现方式：[PythonSIFT](https://github.com/rmislam/PythonSIFT)

> 由于OpenCV3.0将SIFT包含在了扩展部分中，所以官网上下载的版本是没有SIFT的，为此需要到[这里](https://github.com/itseez/opencv_contrib/)下载扩展包，并按照里面的说明重新编译OpenCV（哎~真麻烦，-_-!）。如果你使用其他特征，就不必为此辛劳了。https://blog.csdn.net/AIchipmunk/article/details/48157369

## SIFT Feature Detection

```python
#!/usr/bin/env python
# -*- coding=utf-8 -*-
# Summary: 使用OpenCV3.x-Python检测SIFT特征点
# Author:  Amusi
# Date:    2018-03-17
# Reference: https://docs.opencv.org/master/d5/d3c/classcv_1_1xfeatures2d_1_1SIFT.html
 
import cv2
import numpy
 
def main(): 
	img = cv2.imread("lena.png")
	cv2.imshow('Input Image', img)
	cv2.waitKey(0)
	
	# 检测
	sift = cv2.xfeatures2d.SIFT_create()
	keypoints = sift.detect(img, None)
	
	# 显示
	# 必须要先初始化img2
	img2 = img.copy()
	img2 = cv2.drawKeypoints(img, keypoints, img2, color=(0,255,0))
	cv2.imshow('Detected SIFT keypoints', img2)
	cv2.waitKey(0)
    
if __name__ == '__main__':
	main()
```

## SURF Feature Detection

```python
#!/usr/bin/env python
# -*- coding=utf-8 -*-
# Summary: 使用OpenCV3.x-Python检测SURF特征点
# Author:  Amusi
# Date:    2018-03-17
# Reference: https://docs.opencv.org/master/d5/df7/classcv_1_1xfeatures2d_1_1SURF.html
 
import cv2
import numpy
 
def main():
 
	img = cv2.imread("lena.png")
	cv2.imshow('Input Image', img)
	cv2.waitKey(0)
	
	# 检测
	surf = cv2.xfeatures2d.SURF_create()
	keypoints = surf.detect(img, None)
	
	# 显示
	# 必须要先初始化img2
	img2 = img.copy()
	img2 = cv2.drawKeypoints(img, keypoints, img2, color=(0,255,0))
	cv2.imshow('Detected SURF keypoints', img2)
	cv2.waitKey(0)
    
if __name__ == '__main__':
	main()
```

